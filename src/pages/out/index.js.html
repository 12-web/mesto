<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Api from '../components/Api.js';
import Card from '../components/Card.js';
import FormValidator from '../components/FormValidator.js';
import PopupWithForm from '../components/PopupWithForm';
import PopupWithConfirmation from '../components/PopupWithConfirmation';
import PopupWithImage from '../components/PopupWithImage.js';
import UserInfo from '../components/UserInfo.js';
import Section from '../components/Section.js';
import {
  userNameInput,
  userProfessionInput,
  btnOpenPopupEditProfile,
  btnOpenPopupNewCard,
  btnOpenPopupEditAvatar,
  validationConfig,
  userAvatarInput
} from '../utils/constants.js';

import './index.css';

// ======================================================================================

const formValidators = {};

// ====================== функции =======================================================

/**
 * функция открытия попапа редактирования профиля
 */
function openPopupUserInfo() {
  //внесение данных в поля формы из данных на странице
  const { userName, userProfession } = userInfo.getUserInfo();
  userNameInput.value = userName;
  userProfessionInput.value = userProfession;
  //очистка формы от текста ошибок и проверка состояния кнопки
  formValidators['user_information'].resetValidation();
    // открытие попапа
    popupEditUserInfo.open()
}

/**
 * функция открытия попапа редактирования аватара
 */
function openPopupUserAvatar() {
  //внесение данных в поле формы из данных на странице
  const { userAvatar } = userInfo.getUserInfo();
  userAvatarInput.value = userAvatar;
  //очистка формы от текста ошибок и проверка состояния кнопки
  formValidators['avatar'].resetValidation();
  // открытие попапа
  popupEditAvatar.open()
}

/**
 * функция проверки наличия лайка пользователем
 * @param {Array} likesList - массив лайков
 */
function checkLikeStatus(likesList) {
  return likesList.some(like => {
    return like._id === userInfo.userId;
  });
}

/**
 * функция добавления лайка, при котором отправляется запрос на сервер
 * @param {number} id - id карточки
 */
function addLike(id) {
  // открытие попапа
  api.addLike(id)
    .then(data => {
      this.updateLikes(data.likes.length, checkLikeStatus(data.likes));
    })
    .catch((err) => { console.log(err) });
}

/**
 * функция удаления лайка, при котором отправляется запрос на сервер
 * @param {number} id - id карточки
 */
function removeLike(id) {
  // открытие попапа
  api.removeLike(id)
  .then(data => {
    this.updateLikes(data.likes.length, checkLikeStatus(data.likes));
  })
    .catch((err) => { console.log(err) });
}

/**
 * функция открытия попапа просмотра картинки
 * @param {string} title - заголовок попапа
 * @param {string} link - ссылка на картинку
 */
function handleCardClick(title, link) {
  // открытие попапа
  popupShow.open(title, link);
}

/**
 * функция открытия попапа подтверждения
 * @param {Object} card - объект карточки
 */
function handleDeleteClick(card) {
  // открытие попапа
  popupDeleteCard.open(card);
}

/**
 * функция создания карточки
 * @param {Object} card - объект карточки
 */
function createCard(card) {
  const cardTemplate = new Card(card, 'journey_item', handleCardClick, handleDeleteClick, addLike, removeLike, { likeStatus: false }, { isRemovable: false });
  // проверка создания карточки пользователем
  if(userInfo.userId === cardTemplate.ownerId) cardTemplate.isRemovable = true;
  cardTemplate.updateLikes(card.likes.length, checkLikeStatus(card.likes));

  const cardCompleteElement = cardTemplate.createCard();
  return cardCompleteElement;
}
// ======================================================================================
// ================ классы ==============================================================
const api = new Api({
  baseUrl: 'https://mesto.nomoreparties.co/v1/cohort-68',
  headers: {
    authorization: '14b13473-1b56-4228-afac-2edb4b448b71',
    'Content-Type': 'application/json',
  }
});

const popupShow = new PopupWithImage({
  popupSelector: '.popup_type_show',
});
// добаление обработчиков событий для попапа
popupShow.setEventListeners();

const popupNewCard = new PopupWithForm({
  popupSelector: '.popup_type_add',
  handleSubmitForm: ({ name, link }, button) => {
    popupNewCard.setSubmitButtonText('Сохранение...');
    api.addNewCard(name, link)
      .then(data => cardsSection.addItem(createCard(data)))
      .then(() => popupNewCard.close())
      .catch((err) => { console.log(err) })
      .finally(() => {
        popupNewCard.setSubmitButtonText('Создать');
      });
  }
});
// добаление обработчиков событий для попапа
popupNewCard.setEventListeners();

const userInfo = new UserInfo({
  nameSelector: '.profile__name',
  professionSelector: '.profile__profession',
  avatarSelector: '.profile__img'
});

const popupEditUserInfo = new PopupWithForm({
  popupSelector: '.popup_type_edit',
  handleSubmitForm: ({ name, profession }, button) => {
    popupEditUserInfo.setSubmitButtonText('Сохранение...');
    //добавление данных из формы на страницу
    api.editProfileData(name, profession)
      .then(data => {
        //изменение информации пользователя
        userInfo.setUserInfo({
          name: data.name,
          about: data.about
        });
        popupEditUserInfo.close();
      })
      .then(() => popupEditUserInfo.close())
      .catch((err) => { console.log(err) })
      .finally(() => {
        popupEditUserInfo.setSubmitButtonText('Сохранить');
      });
  }
});
// добаление обработчиков событий для попапа
popupEditUserInfo.setEventListeners();

const popupEditAvatar = new PopupWithForm({
  popupSelector: '.popup_type_avatar',
  handleSubmitForm: ({ avatar }, button) => {
    popupEditAvatar.setSubmitButtonText('Сохранение...');
    api.editUserAvatar(avatar)
      .then(res => userInfo.setUserImage({ avatar: res.avatar }))
      .then(() => popupEditAvatar.close())
      .catch((err) => { console.log(err) })
      .finally(() => {
        popupEditAvatar.setSubmitButtonText('Сохранить');
      });
  }
});
// добаление обработчиков событий для попапа
popupEditAvatar.setEventListeners();

const popupDeleteCard = new PopupWithConfirmation({
  popupSelector: '.popup_type_delete-confirm',
  handleSubmitForm: (id, card) => {
      api.deleteCard(id)
      .then(() => card.deleteJourneyCard())
      .then(() => popupDeleteCard.close())
      .catch((err) => { console.log(err) });
  }
});
// добаление обработчиков событий для попапа
popupDeleteCard.setEventListeners();

const cardsSection = new Section({
  renderer: item => {
    const card = createCard(item);
    cardsSection.addItem(card);
  }
  },
'.journey__list'
);

Promise.all([api.getUserInformation(), api.getInitialCards()])
  .then(([userData, cardsList]) => {
    // получение информации о пользователе
    userInfo.setUserInfo(userData);
    userInfo.setUserImage({ avatar: userData.avatar });
    // получение карточек
    cardsSection.renderItems(cardsList);
  })
  .catch((err) => { console.log(err) });

// запуск валидации всех форм
Array.from(document.forms).forEach(form => {
  const formValidator = new FormValidator(validationConfig, form);
  //добавление данных о валидируемой форме
  const formName = form.getAttribute('name');
  formValidators[formName] = formValidator;
  //включение валидации
  formValidator.enableValidation();
 });

// ================ слушатели событий ===================================================

// открытие попапа редактирования данных профиля
btnOpenPopupEditProfile.addEventListener('click', openPopupUserInfo);

// открытие попапа добавление новой карточки
btnOpenPopupNewCard.addEventListener('click', () => popupNewCard.open());

// открытие попапа изменения аватара пользователя
btnOpenPopupEditAvatar.addEventListener('click', openPopupUserAvatar);

// ======================================================================================
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addLike">addLike</a></li><li><a href="global.html#checkLikeStatus">checkLikeStatus</a></li><li><a href="global.html#createCard">createCard</a></li><li><a href="global.html#handleCardClick">handleCardClick</a></li><li><a href="global.html#handleDeleteClick">handleDeleteClick</a></li><li><a href="global.html#openPopupUserAvatar">openPopupUserAvatar</a></li><li><a href="global.html#openPopupUserInfo">openPopupUserInfo</a></li><li><a href="global.html#removeLike">removeLike</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Jun 04 2023 00:46:01 GMT+0300 (Москва, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
